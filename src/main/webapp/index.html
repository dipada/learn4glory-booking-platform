<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="resources/css/style.css" rel="stylesheet">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
          integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <script src="https://kit.fontawesome.com/51a3bcc63b.js" crossorigin="anonymous"></script>

    <script src="resources/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <title>Learn4Glory</title>

</head>

<body>
<div id="vue">
    <header class="topHeader">
        <div id="logoContainer">
            <img @click="showHomepage" src="resources/logo.svg" alt="Application Logo">
        </div>

        <nav id="navMenu" v-if="!logged">
            <button id="btnLogin" @click="showLoginPage">Accedi</button>
            <button onclick="location.href='registration.html'" id="btnSignUp">Registrati</button>
        </nav>

        <nav id="navMenuLogged" v-if="logged">
            <button id="btnSearchLesson" @click="showCoursePage"><i class="fa fa-search" aria-hidden="true"></i> Trova una lezione</button>
            <button id="btnMyBookedLesson" @click="showMyBookingsPage"><i class="fa fa-book" aria-hidden="true"></i> Le mie prenotazioni</button>
            <button id="btnLessonSummary" @click="showLessonSummaryPage"><i class="fa fa-calendar" aria-hidden="true"></i> Riepilogo lezioni disponibili</button>
            <button id="btnSignOut" @click="logout"><i class="fa fa-sign-out" aria-hidden="true"></i> Disconnetti</button>
        </nav>
        <button class="icon" onclick="openHamburgerMenu()">
            <i id="icn" class="fa fa-bars"></i>

            <!--
            <i class="fa fa-minus" aria-hidden="true"></i>
            -->
        </button>
    </header>

    <article>

        <section v-if="coursePage">
            <h2>Scegli un corso</h2>

            <div class="cards-list">
                <div @click="currentCourseSelected=course" v-on:click="showTeacherOfCoursePage" v-for="course in courseList" class="card">
                    <div class="card_title">
                        <p>{{course.title}}</p>
                    </div>
                </div>
            </div>
        </section>

        <section v-if="teacherOfCoursePage">
            <h2>Hai selezionato <span style="color: #FF4539">{{currentCourseSelected.title}}</span>. {{statusMsg}}</h2>
            <div class="cards-list">
                <div @click="currentTeacherSelected=teacher" v-on:click="showTeacherSummaryPage" v-for="teacher in teachersOfCourse" class="card">
                    <div class="card_title">
                        <p>{{teacher.name}} - {{teacher.surname}}</p>
                    </div>
                </div>
            </div>
            <div class="flow-buttons">
                <button @click="showCoursePage" class="btn-flow btn-back">Torna ai corsi</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>

        <section v-if="teacherSummaryPage">
            <h2>Le disponibilit√† per <span style="color: #FF4539">{{currentCourseSelected.title}}</span> di {{currentTeacherSelected.name}} {{currentTeacherSelected.surname}}. {{statusMsg}}</h2>

            <table class="grid-lessons">
                <thead>
                <tr>
                    <th></th>
                    <th>Luned&igrave;</th>
                    <th>Marted&igrave;</th>
                    <th>Mercoled&igrave;</th>
                    <th>Gioved&igrave;</th>
                    <th class="last-column-cells">Venerd&igrave;</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>15-16</th>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='LUN' && lesson.hour === 15"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MAR' && lesson.hour === 15"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MER' && lesson.hour === 15"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='GIO' && lesson.hour === 15"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td class="last-column-cells"> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='VEN' && lesson.hour === 15"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                </tr>

                <tr>
                    <th>16-17</th>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='LUN' && lesson.hour === 16"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MAR' && lesson.hour === 16"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MER' && lesson.hour === 16"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='GIO' && lesson.hour === 16"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td class="last-column-cells"> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='VEN' && lesson.hour === 16"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span v-else tabindex="0" class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                </tr>

                <tr>
                    <th>17-18</th>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='LUN' && lesson.hour === 17"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MAR' && lesson.hour === 17"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MER' && lesson.hour === 17"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='GIO' && lesson.hour === 17"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td class="last-column-cells"> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='VEN' && lesson.hour === 17"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                </tr>

                <tr>
                    <th>18-19</th>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='LUN' && lesson.hour === 18"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MAR' && lesson.hour === 18"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='MER' && lesson.hour === 18"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='GIO' && lesson.hour === 18"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                    <td class="last-column-cells"> <p v-for="lesson in listTeacherLessons" v-if="lesson.week_day==='VEN' && lesson.hour === 18"><span class="lesson-booked" v-if="isBooked(lesson.id_lesson)">Prenotato</span><span tabindex="0" v-else class="lesson-available" @click="prepareReservation(lesson)">Libero</span></p></td>
                </tr>
                </tbody>
            </table>

            <h3>{{errorMsg}}</h3>

            <div class="flow-buttons">
                <button @click="showTeacherOfCoursePage" class="btn-flow btn-back">Torna ai docenti</button>
                <button v-if="reserveClick" @click="reserveSelectedLesson" class="btn-flow btn-next">Prenota</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>
        <!-- TODO lezione disponibile dopo aver cliccato un docente. Solo per utenti loggati -->

        <section v-if="bookingPage">
            <h2>Riepilogo prenotazione</h2>

            <div class="booking-summary">
                <p>Utente: <span>{{userEmail}}</span></p>
                <p>Lezione: <span>{{currentLessonToBook.course.title}}</span></p>
                <p>Docente: <span>{{currentLessonToBook.teacher.name}} {{currentLessonToBook.teacher.surname}}</span></p>
                <p>Data e ora: <span>{{dayHourBookingLess}}</span></p>
            </div>

            <div class="flow-buttons">
                <button @click="cancelBooking" class="btn-flow btn-back">Annulla</button>
                <button @click="makeBooking" class="btn-flow btn-next">Conferma</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>

        <section v-if="bookingSuccessPage">
            <h2>Prenotazione effettuata con successo!</h2>
            <div class="flow-buttons">
                <button @click="showMyBookingPage" class="btn-flow btn-back">Mostra le mie prenotazioni</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>

        <section v-if="myBookingsPage">
            <h2>Le mie prenotazioni</h2>
            <div class="my-booking">
                <div v-for="booking in listBookedLessons">
                    <p>Lezione: <span>{{booking.lesson.course.title}}</span></p>
                    <p>Docente: <span>{{booking.lesson.teacher.name}} {{booking.lesson.teacher.surname}}</span></p>
                    <p>Data e ora: <span>{{booking.lesson.week_day}} {{booking.lesson.hour}}:00</span></p>
                    <p>Stato: <span>{{booking.status}}</span></p>
                    <p>Feedback: <span>{{booking.feedback}}</span></p>
                    <button @click="deleteBooking(booking.id_booking)">Elimina</button>
                </div>
            </div>
            <div class="flow-buttons">
                <button @click="showTeacherOfCoursePage" class="btn-flow btn-back">Torna ai docenti</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>


        <section v-if="lessonSummaryPage">
            <h2>Le lezioni di questa settimana</h2>

        </section>

        <section v-if="errorPage">
            <h2>{{statusMsg}}</h2>
            <div class="flow-buttons">
                <button @click="showLastPage" class="btn-flow btn-back">Reload</button>
                <!-- <button class="btn-flow btn-next">Visualizza docenti</button> -->
            </div>
        </section>

        <section v-if="loginPage">

            <div id="loginForm">
                <div class="imgcontainer">
                    <img src="" alt="Avatar" class="avatar">
                </div>

                <div class="form-container">
                    <label for="loginEmail"><b>Indirizzo e-mail</b></label>
                    <input id="loginEmail" v-model="userEmail" type="email" placeholder="Indirizzo e-mail"
                           name="userEmail" pattern="[a-z0-9._%+-]+@[a-z0-9]+\.[a-z]{2,4}" title="latuaemail@esempio.it"
                           required>

                    <label for="loginPsw"><b>Password</b></label>
                    <input id="loginPsw" v-model="userPwd" type="password" placeholder="Password" name="psw"
                           pattern="[A-Za-z0-9]{3,6}" title="Inserisci almeno 3 caratteri" required>

                    <button @click="login" type="submit">Accedi</button>
                    <p>{{userEmail}} - {{userPwd}} - {{statusMsg}}</p>
                </div>
            </div>
        </section>

    </article>


        <!-- <div>{{userEmail}} - {{userPwd}} - {{statusMsg}} - {{userRole}}</div>
        <div></div>
        -->


    <footer>

    </footer>

</div>

<script src="vue.js"></script>
</body>
</html>